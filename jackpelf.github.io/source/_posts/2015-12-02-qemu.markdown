---
layout: post
title: "qemu"
date: 2015-12-02 00:27:47 +0800
comments: true
categories: 
---
# qemu

###note
使用方法：全路径运行，cat目录下的stdout.txt查看信息
gdbserver不能显示symbols

###install
安装交叉环境
apt-get install gcc-arm-linux-gnueabi
安装gdb
apt-get install gdb-arm-none-eabi
gdb 是在i386下的arm调试器


###run
qemu user mode
```bash
#!/bin/bash

if [ "$#" == "1" ]; then
	qemu-arm /usr/arm-linux-gnueabi/lib/ld-linux.so.3 --library-path /usr/arm-linux-gnueabi/lib $1
    exit 1
fi

if [ "$#" != "2" ]; then
    echo "usage: $0 <exec file> <port>"
    exit 1
fi

qemu-arm -g $2 /usr/arm-linux-gnueabi/lib/ld-linux.so.3 --library-path /usr/arm-linux-gnueabi/lib $1
```

###gdb
gdb远程调试
target remote 192.168.56.101:8888
gdb使用symbol-file载入符号文件
set sysroot设置动态库查找路径

###arm-gcc
交叉编译工具链的命名规则为：arch [-vendor] [-os] [-(gnu)eabi]  
arm-none-linux-gnueabi   linux系统  
gcc-arm-none-eabi  猜测arm公司，无操作系统限制  
arm-linux-gcc 使用glibc  
arm-elf-gcc使用uClibc  
arm-none-eabi  无系统，针对嵌入式，使用newlib  
arm-eabi-gcc 安卓ARM编译器  
arm-none-linux-gnueabi-gcc由Codesourcery公司优化的编译器  

###qemu

--append添加内核启动参数  


###qemu网络
-net nic表示虚拟机的OS添加新的网卡  
-net user -net nic连接互联网
windows tap网卡设置名称mytap，设置ip为192.168.200.10 netmask为255.255.255.0启动选项为-net nic -net tap,ifname=mytap
网络设置虚拟机内
```
auto eth0
iface eth0 inet static
address 192.168.200.11
netmask 255.255.255.0
network 192.168.200.0
broadcast 192.168.200.255
```

