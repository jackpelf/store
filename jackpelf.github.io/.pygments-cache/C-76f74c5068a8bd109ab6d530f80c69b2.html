<div class="highlight"><pre><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">sub_401080</span><span class="p">(</span><span class="kt">int</span> <span class="n">hex0</span><span class="p">,</span> <span class="kt">signed</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// esi@1</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span> <span class="c1">// edi@2</span>
  <span class="kt">int</span> <span class="n">k</span><span class="p">;</span> <span class="c1">// eax@3</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// eax@10</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">pp</span><span class="p">;</span> <span class="c1">// esi@11</span>
  <span class="kt">char</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// dl@12</span>
  <span class="kt">int</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [sp+Ch] [bp-200h]@1</span>
  <span class="kt">char</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [sp+10h] [bp-1FCh]@2</span>

  <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">v9</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">len</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>                                             <span class="c1">// 和开始相等，第几个则赋值几-1</span>
    <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v10</span><span class="p">;</span>
    <span class="k">do</span>
    <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span> <span class="n">k</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="n">k</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v9</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="p">)</span><span class="c1">// 不相等则回溯到前面相等的地方</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">i</span> <span class="o">+</span> <span class="n">hex0</span><span class="p">)</span> <span class="o">==</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">hex0</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">i</span> <span class="o">+</span> <span class="n">hex0</span><span class="p">)</span> <span class="o">==</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">hex0</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>                   <span class="c1">// 直到找到当前字符和next[l]相等，赋值next[l]=l+1,否则赋值-1</span>
      <span class="k">else</span>
        <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="o">++</span><span class="n">i</span><span class="p">;</span>
      <span class="n">p</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v9</span><span class="p">;</span>
    <span class="k">do</span>                                          <span class="c1">// 异或0x18加上匹配的个数</span>
    <span class="p">{</span>
      <span class="n">v7</span> <span class="o">=</span> <span class="o">*</span><span class="n">pp</span> <span class="o">+</span> <span class="mh">0x19</span><span class="p">;</span>
      <span class="o">++</span><span class="n">pp</span><span class="p">;</span>
      <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">j</span><span class="o">++</span> <span class="o">+</span> <span class="n">hex0</span><span class="p">)</span> <span class="o">^=</span> <span class="n">v7</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">len</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>