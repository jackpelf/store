
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Prog-link - Jackpelf' Blog</title>
  <meta name="author" content="Jackpelf">

  
  <meta name="description" content="0x00 节区 .rel.text当连接器把这个目标文件和其他文件结合时，需要修改这些位置
.rel.data被模块引用或定义的全局变量的重定位信息
.debug一个调试符号表，条目是程序中定义的局部变量和类型定义。
.line源程序行号和.text节中机器指令的映射 0x01 符号表 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jackpelf.github.io/blog/2015/09/17/prog-link/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jackpelf' Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Jackpelf' Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="jackpelf.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Prog-link</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-17T16:34:46+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:34 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><h3>0x00 节区</h3>

<p>.rel.text当连接器把这个目标文件和其他文件结合时，需要修改这些位置
.rel.data被模块引用或定义的全局变量的重定位信息
.debug一个调试符号表，条目是程序中定义的局部变量和类型定义。
.line源程序行号和.text节中机器指令的映射</p>

<h3>0x01 符号表</h3>

<p>有三种不同的符号：
由自身定义并能被其他模块引用的全局变量。对应于非静态函数和定义为不带static的全局变量
其他模块定义的全局符号，称为外部符号，对应于定义在其他模块中的函数和变量
只被自身定义和引用的本地富豪，有的本地符号对应于带static属性的函数和全局变量。</p>

<pre><code>typedef struct{
    int name;
    int value;
    int size;
    char type:4,
         bintding:4;
    char reserved;
    char section;
}ELF_Symbol
</code></pre>

<p>name是字符串表中的字节偏移，value是符号的地址，对于可重定位文件来说，该值是距定义目标节的起始位置的偏移，对于可执行目标文件来说，该值是一个绝对地址,size是目标大小,type通常是数据或是函数。binding表示符号是本地的还是全局的
三个伪节：ABS代表不该被重定位的符号，UNDEF代表未定义的符号，在本目标模块中引用，却在其他模块定义。COMMON是还未分配位置的未初始化数据目标，对于COMMON符号，value字段给出对齐要求，size给出最小大小。</p>

<h3>0x02 连接器解析多重定义的符号</h3>

<p>函数和已初始化的全局变量是枪符号，未初始化的符号是弱符号。
-不允许有多个强符号
-如果有一个强符号和多个弱符号，那么选择强符号
-如果有多个弱符号，则任意选择一个</p>

<h3>0x03 与静态库链接</h3>

<p>静态库中的函数被编译成独立的目标模块,然后封装成一个单独的静态库文件。静态库以一种称为存档的特殊文件格式存放在磁盘中，存档文件是一组连接起来的可重定位文件的集合，有一个头部用来描述每个成员目标文件的大小和位置。以后缀.a标示。</p>

<h3>0x04 重定位项目</h3>

<p>重定位条目格式
    typedef struct{
        int offset;     引用地址
        int symbol:24,      指向符号表
            type:8;     类型
    }Elf32_Rel;
Elf定义了11种不同的重定位类型
R_386_PC32:使用一个32位pc相对地址的引用，就是一个PC相对于当前运行时的偏移量。
R_386_32绝对地址</p>

<h3>0x05 可执行目标文件</h3>

<p>init节定义了一个小函数，叫做<em>init,程序初始化代码会调用它，
每个Unix程序都有一个运行时的储存器镜像。
加载器将可执行文件的内容拷贝到代码段和数据段，接下来加载器跳转到程序入口点即</em>start的地址。
——start启动代码是在ctrl.o中定义的。在调用了初始化例程后，启动代码调用atexit,这个程序附加了一系列在应用程序终止时应该调用的程序，exit函数运行atexit注册的函数，然后调用_exit控制返回操作系统。接着调用main函数.</p>

<pre><code>call __libc_init_first      //startup code in .text
call _init          //startup code in .init
call atexit         //startup code in .text
call main
call _exit
</code></pre>

<h3>0x06 共享库</h3>

<p>共享库的一个主要目的就是多个进程共享储存器中的库代码。
PIC数据引用，在数据段开始的地方创建一个表，叫做全局偏移量表（GOT)，
每个被这个目标模块引用的全局数据对象都有一个条目，编译器还为GOT中每个条目生成一个重定位记录。
在加载时，动态连接器会重定位GOT的每个条目，使他包含正确的绝对地址。</p>

<pre><code>    call L1
L1: popl %ebx
    addl %VAROFF, %ebx
    movl (%ebx), %eax
    movl (%eax), %eax
</code></pre>

<p>PIC函数调用</p>

<pre><code>    call L1
L1: popl %ebx
    addl $PROCOFF, %ebx
    call *(%ebx) 
</code></pre>

<p>GOT前三项
.dynamic的地址
链接器标示的信息
动态链接器的延迟绑定代码入口点</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jackpelf</span></span>

      




<time class='entry-date' datetime='2015-09-17T16:34:46+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:34 pm</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jackpelf.github.io/blog/2015/09/17/prog-link/" data-via="" data-counturl="http://jackpelf.github.io/blog/2015/09/17/prog-link/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/09/17/sys/" title="Previous Post: sys">&laquo; sys</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/09/18/codegate-bookstore/" title="Next Post: codegate_bookstore">codegate_bookstore &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/19/des-and-aes/">DES &amp; AES</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/18/codegate-bookstore/">Codegate_bookstore</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/17/prog-link/">Prog-link</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/17/sys/">Sys</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/17/codegate-shock/">Codegate Shock</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Jackpelf -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
